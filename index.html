<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculator — Single File</title>
  <style>
    :root{
      --bg:#0f1724; --panel:#0b1220; --accent:#7c3aed; --muted:#94a3b8; --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:linear-gradient(180deg,#071024 0%, #081427 100%); color:#e6eef8}
    .wrap{min-height:100dvh;display:flex;align-items:center;justify-content:center;padding:24px}

    .calculator{
      width:340px; max-width:96vw; background:linear-gradient(180deg,var(--panel), #071122); border-radius:16px; padding:18px; box-shadow: 0 10px 30px rgba(2,6,23,0.6);
    }

    .display{
      background:var(--glass); border-radius:12px; padding:14px; display:flex; flex-direction:column; gap:6px; margin-bottom:12px; min-height:84px;
    }

    .top-row{display:flex;justify-content:space-between;align-items:center}
    .memory-indicator{font-size:12px;color:var(--muted)}
    .secondary{font-size:14px;color:var(--muted);min-height:18px;word-break:break-all}
    .main{font-size:28px;font-weight:600;text-align:right}

    .keys{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    button.key{
      background:transparent;border:0;padding:16px;border-radius:10px;font-size:18px;color:inherit;cursor:pointer;transition:transform .06s ease, box-shadow .06s ease;box-shadow: inset 0 -3px 0 rgba(0,0,0,0.15);
    }
    button.key:active{transform:translateY(2px)}

    .btn-operator{background:linear-gradient(180deg, rgba(124,58,237,0.18), rgba(124,58,237,0.12));color:var(--accent);}
    .btn-special{background:rgba(255,255,255,0.02);color:var(--muted)}
    .btn-equals{grid-column:span 2;background:linear-gradient(90deg,var(--accent), #4f46e5);color:white;font-weight:700}

    .kbd-hint{font-size:12px;color:var(--muted);text-align:center;margin-top:10px}

    @media (max-width:420px){.main{font-size:22px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="calculator" role="application" aria-label="Calculator">
      <div class="display" aria-live="polite">
        <div class="top-row">
          <div class="memory-indicator" id="mem">M: —</div>
          <div style="font-size:12px;color:var(--muted)">JS Calculator</div>
        </div>
        <div class="secondary" id="expr">0</div>
        <div class="main" id="output">0</div>
      </div>

      <div class="keys">
        <button class="key btn-special" data-action="clear">C</button>
        <button class="key btn-special" data-action="back">⌫</button>
        <button class="key btn-special" data-action="percent">%</button>
        <button class="key btn-operator" data-value="/">÷</button>

        <button class="key" data-value="7">7</button>
        <button class="key" data-value="8">8</button>
        <button class="key" data-value="9">9</button>
        <button class="key btn-operator" data-value="*">×</button>

        <button class="key" data-value="4">4</button>
        <button class="key" data-value="5">5</button>
        <button class="key" data-value="6">6</button>
        <button class="key btn-operator" data-value="-">−</button>

        <button class="key" data-value="1">1</button>
        <button class="key" data-value="2">2</button>
        <button class="key" data-value="3">3</button>
        <button class="key btn-operator" data-value="+">+</button>

        <button class="key" data-action="plusminus">±</button>
        <button class="key" data-value="0">0</button>
        <button class="key" data-value=".">.</button>
        <button class="key btn-equals" data-action="equals">=</button>
      </div>

      <div class="kbd-hint">Type numbers and + - * / . Enter = or press the = button. Esc clears.</div>
    </div>
  </div>

  <script>
    (function(){
      const exprEl = document.getElementById('expr');
      const outEl = document.getElementById('output');
      const memEl = document.getElementById('mem');

      let expr = '';
      let memory = null;

      function updateDisplay(){
        exprEl.textContent = expr || '0';
        outEl.textContent = evaluatePreview(expr) ?? '0';
        memEl.textContent = 'M: ' + (memory === null ? '—' : memory);
      }

      function pushValue(v){
        // prevent multiple leading zeros
        if(!expr && v === '0') { expr = '0'; updateDisplay(); return }

        // if last token was number and expr == '0', replace
        if(expr === '0' && /[0-9.]/.test(v)) expr = v;
        else expr += v;
        updateDisplay();
      }

      function isSafeExpression(s){
        if(!s) return true;
        // allow digits, spaces, operators, parentheses and decimal point
        const safe = /^[0-9+\-*/().% ]+$/;
        return safe.test(s);
      }

      function evaluatePreview(s){
        if(!s) return '0';
        try{
          if(!isSafeExpression(s)) return 'Err';
          // convert percent: treat a% as (/100)
          const norm = s.replace(/%/g, '/100');
          // Avoid accidental leading operator errors
          const result = Function('return ('+norm+')')();
          if(result === undefined || Number.isNaN(result)) return 'Err';
          // show short version
          return trimNumber(result);
        }catch(e){ return 'Err' }
      }

      function trimNumber(n){
        if(!Number.isFinite(n)) return String(n);
        // limit to 12 significant digits
        const s = n.toString();
        if(s.length <= 12) return s;
        return Number.parseFloat(n.toPrecision(12)).toString();
      }

      function pressKey(key){
        if(key === 'clear'){ expr = ''; updateDisplay(); return }
        if(key === 'back'){ expr = expr.slice(0,-1); updateDisplay(); return }
        if(key === 'equals'){
          const val = evaluatePreview(expr);
          if(val === 'Err') { outEl.textContent = 'Error'; return }
          expr = String(val);
          updateDisplay();
          return;
        }
        if(key === 'percent'){
          expr += '%'; updateDisplay(); return;
        }
        if(key === 'plusminus'){
          // toggle sign of the last number in expression
          const m = expr.match(/(.*?)([-+]?[0-9.]+)$/);
          if(m){
            const prefix = m[1] || '';
            const num = m[2];
            if(num.startsWith('-')) expr = prefix + num.slice(1);
            else expr = prefix + '-' + num;
          } else {
            expr = '-'+expr;
          }
          updateDisplay();
          return;
        }
        // value (digit or operator)
        pushValue(key);
      }

      document.querySelectorAll('button.key').forEach(btn => {
        btn.addEventListener('click', ()=>{
          const action = btn.dataset.action;
          const value = btn.dataset.value;
          if(action) pressKey(action); else pressKey(value);
        })
      });

      // keyboard support
      window.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape') { pressKey('clear'); e.preventDefault(); return }
        if(e.key === 'Enter' || e.key === '=') { pressKey('equals'); e.preventDefault(); return }
        if(e.key === 'Backspace') { pressKey('back'); e.preventDefault(); return }
        if(/[0-9]/.test(e.key)) { pressKey(e.key); e.preventDefault(); return }
        if(e.key === '.') { pressKey('.'); e.preventDefault(); return }
        if(e.key === '%') { pressKey('percent'); e.preventDefault(); return }
        if(['+','-','*','/','(',')'].includes(e.key)) { pressKey(e.key); e.preventDefault(); return }
      });

      // initialize
      updateDisplay();
    })();
  </script>
</body>
</html>
